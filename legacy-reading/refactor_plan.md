# Safe Refactor Plan (Legacy Reading)

## 目的
他人が書いたコードの意図を汲み、壊さず改善できることを示す。

## 進め方（安全重視）

### Step 1: 振る舞い固定テストを先に書く
- 返り値の代表ケース（正常/異常/境界）を列挙。
- 副作用（監査ログ更新・実行回数）もテスト対象に含める。
- グローバル状態を各テスト前に初期化して再現性を担保。

### Step 2: 小さな変更を段階的に入れる
- 1回の変更で1つの意図のみ（命名改善、関数分割、定数化など）。
- 毎ステップでテスト実行し、差分の影響範囲を限定。
- 外部契約（関数シグネチャ/副作用）は互換ラッパーで保持。

### Step 3: レビュー観点を明示する
- **互換性**: 既存仕様（戻り値+副作用）が保持されているか。
- **可読性**: 用語が業務意味に沿っているか。
- **テスト妥当性**: 重要分岐がテストで押さえられているか。
- **拡張性**: 係数・分岐追加時に変更点が局所化されるか。

## 受け入れ条件
- `test_legacy.py` が全て通る。
- before/after の差分が「読みやすさ向上」であることを説明できる。
- 仕様不明点はコメントではなく「観測事実」としてメモ化されている。
